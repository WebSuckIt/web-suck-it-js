{"code":"import forge from \"node-forge\";\r\nexport class Base {\r\n    userId;\r\n    accessKey;\r\n    baseUrl = \"http://locahost:9999\";\r\n    wssBaseUrl = \"ws://locahost:9999\";\r\n    constructor(config) {\r\n        this.userId = config.userId;\r\n        this.accessKey = config.accessKey;\r\n    }\r\n    messageEncryption(args) {\r\n        const { publicKey, userId, channelName, channelPassKey, replaySelf } = args;\r\n        const replay = replaySelf !== undefined ? `&replay_self=${replaySelf}` : \"\";\r\n        const encodedToken = `user_id=${userId}&channel=${channelName}&channel_pass_key=${channelPassKey}${replay}`;\r\n        const forgePublicKey = forge.pki.publicKeyFromPem(publicKey);\r\n        const encryptedToken = forgePublicKey.encrypt(encodedToken, \"RSA-OAEP\", {\r\n            md: forge.md.sha256.create(),\r\n        });\r\n        const base64EncodedEncryptedToken = forge.util\r\n            .encode64(encryptedToken)\r\n            .replace(/\\+/g, \"-\")\r\n            .replace(/\\//g, \"_\")\r\n            .replace(/=+$/, \"\");\r\n        return `${userId}/${channelName}?encrypted_token=${base64EncodedEncryptedToken}${replay}`;\r\n    }\r\n    connect(args) {\r\n        const webSocketConnection = (this.wssBaseUrl +\r\n            this.messageEncryption(args));\r\n        return webSocketConnection;\r\n    }\r\n    request(endpoint, options) {\r\n        const url = `${this.baseUrl}${endpoint}`;\r\n        const headers = {\r\n            \"Content-Type\": \"application/json\",\r\n        };\r\n        const config = {\r\n            ...options,\r\n            headers,\r\n        };\r\n        return fetch(url, config).then((response) => {\r\n            if (response.ok) {\r\n                return response.json();\r\n            }\r\n            throw new Error(response.statusText);\r\n        });\r\n    }\r\n}\r\n","references":["/Users/sylvernusakubo/learn/web-suck-it/javascript-workspace/node_modules/@types/node-forge/index.d.ts"],"dts":{"name":"/Users/sylvernusakubo/learn/web-suck-it/javascript-workspace/sdk/javascript/dist/base.d.ts","writeByteOrderMark":false,"text":"type Config = {\r\n    userId: string;\r\n    accessKey?: string;\r\n};\r\ntype connectToChannelReq = {\r\n    publicKey: string;\r\n    channelName: string;\r\n    channelPassKey: string;\r\n    userId: string;\r\n    replaySelf?: boolean;\r\n};\r\nexport declare abstract class Base {\r\n    private userId;\r\n    private accessKey?;\r\n    private baseUrl;\r\n    private wssBaseUrl;\r\n    constructor(config: Config);\r\n    private messageEncryption;\r\n    connect(args: connectToChannelReq): WebSocket;\r\n    protected request<T>(endpoint: string, options?: RequestInit): Promise<T>;\r\n}\r\nexport {};\r\n"}}
