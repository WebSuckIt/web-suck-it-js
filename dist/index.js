function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=/*#__PURE__*/e(require("node-forge"));function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}var s,c=/*#__PURE__*/function(){function e(e){this.userId=void 0,this.accessKey=void 0,this.baseUrl="http://locahost:9999",this.wssBaseUrl="ws://locahost:9999",this.userId=e.userId,this.accessKey=e.accessKey}var r=e.prototype;return r.messageEncryption=function(e){var n=e.userId,r=e.channelName,o=e.replaySelf,s=void 0!==o?"&replay_self="+o:"",c="user_id="+n+"&channel="+r+"&channel_pass_key="+e.channelPassKey+s,a=t.default.pki.publicKeyFromPem(e.publicKey).encrypt(c,"RSA-OAEP",{md:t.default.md.sha256.create()});return n+"/"+r+"?encrypted_token="+t.default.util.encode64(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")+s},r.connect=function(e){return new WebSocket(this.wssBaseUrl+this.messageEncryption(e))},r.request=function(e,t){var r=""+this.baseUrl+e,o=n({},t,{headers:{"Content-Type":"application/json"}});return fetch(r,o).then(function(e){if(e.ok)return e.json();throw new Error(e.statusText)})},e}(),a="channel",i=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var o=t.prototype;return o.createChannel=function(e){return this.request("/"+a+"/create",{method:"POST",body:JSON.stringify(e)})},o.updateChannel=function(e){return this.request("/"+a+"/update",{method:"POST",body:JSON.stringify(e)})},o.getChannelByName=function(e){return this.request("/"+a+"/"+(null==e?void 0:e.channelName)+"/details")},o.getChannels=function(e){var t=new URLSearchParams(n({},e));return this.request("/"+a+"/list?"+t)},t}(c),u=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(c);s=u,[i].forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(t){Object.defineProperty(s.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))})}),module.exports=u;
