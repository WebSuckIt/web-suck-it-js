!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("node-forge")):"function"==typeof define&&define.amd?define(["node-forge"],t):(e||self).js=t(e.nodeForge)}(this,function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=/*#__PURE__*/t(e);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}var i,c=/*#__PURE__*/function(){function e(e){this.userId=void 0,this.accessKey=void 0,this.baseUrl="http://locahost:9999",this.wssBaseUrl="ws://locahost:9999",this.userId=e.userId,this.accessKey=e.accessKey}var t=e.prototype;return t.messageEncryption=function(e){var t=e.userId,r=e.channelName,o=e.replaySelf,s=void 0!==o?"&replay_self="+o:"",i="user_id="+t+"&channel="+r+"&channel_pass_key="+e.channelPassKey+s,c=n.default.pki.publicKeyFromPem(e.publicKey).encrypt(i,"RSA-OAEP",{md:n.default.md.sha256.create()});return t+"/"+r+"?encrypted_token="+n.default.util.encode64(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")+s},t.connect=function(e){return new WebSocket(this.wssBaseUrl+this.messageEncryption(e))},t.request=function(e,t){var n=""+this.baseUrl+e,o=r({},t,{headers:{"Content-Type":"application/json"}});return fetch(n,o).then(function(e){if(e.ok)return e.json();throw new Error(e.statusText)})},e}(),a="channel",u=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var n=t.prototype;return n.createChannel=function(e){return this.request("/"+a+"/create",{method:"POST",body:JSON.stringify(e)})},n.updateChannel=function(e){return this.request("/"+a+"/update",{method:"POST",body:JSON.stringify(e)})},n.getChannelByName=function(e){return this.request("/"+a+"/"+(null==e?void 0:e.channelName)+"/details")},n.getChannels=function(e){var t=new URLSearchParams(r({},e));return this.request("/"+a+"/list?"+t)},t}(c),p=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(c);return i=p,[u].forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(t){Object.defineProperty(i.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))})}),p});
