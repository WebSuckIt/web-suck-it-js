import e from"node-forge";function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}var o,s=/*#__PURE__*/function(){function n(e){this.userId=void 0,this.accessKey=void 0,this.baseUrl="http://locahost:9999",this.wssBaseUrl="ws://locahost:9999",this.userId=e.userId,this.accessKey=e.accessKey}var r=n.prototype;return r.messageEncryption=function(t){var n=t.userId,r=t.channelName,o=t.replaySelf,s=void 0!==o?"&replay_self="+o:"",c="user_id="+n+"&channel="+r+"&channel_pass_key="+t.channelPassKey+s,a=e.pki.publicKeyFromPem(t.publicKey).encrypt(c,"RSA-OAEP",{md:e.md.sha256.create()});return n+"/"+r+"?encrypted_token="+e.util.encode64(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")+s},r.connect=function(e){return new WebSocket(this.wssBaseUrl+this.messageEncryption(e))},r.request=function(e,n){var r=""+this.baseUrl+e,o=t({},n,{headers:{"Content-Type":"application/json"}});return fetch(r,o).then(function(e){if(e.ok)return e.json();throw new Error(e.statusText)})},n}(),c="channel",a=/*#__PURE__*/function(e){function r(){return e.apply(this,arguments)||this}n(r,e);var o=r.prototype;return o.createChannel=function(e){return this.request("/"+c+"/create",{method:"POST",body:JSON.stringify(e)})},o.updateChannel=function(e){return this.request("/"+c+"/update",{method:"POST",body:JSON.stringify(e)})},o.getChannelByName=function(e){return this.request("/"+c+"/"+(null==e?void 0:e.channelName)+"/details")},o.getChannels=function(e){var n=new URLSearchParams(t({},e));return this.request("/"+c+"/list?"+n)},r}(s),i=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t}(s);o=i,[a].forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(t){Object.defineProperty(o.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t)||Object.create(null))})});export{i as default};
